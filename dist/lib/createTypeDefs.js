"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.createTypeDefs=void 0;var _lodash=_interopRequireDefault(require("lodash")),_stream=require("stream"),_async=_interopRequireDefault(require("async")),_fsExtra=_interopRequireDefault(require("fs-extra")),_path=_interopRequireDefault(require("path")),_config=_interopRequireDefault(require("../config")),_mississippi=require("mississippi");class TypeReader extends _stream.Readable{constructor(a){super(),this.openComment=a=>{this.push("/**\n"),a()},this.closeComment=a=>{this.push(" */\n\n"),a()},this.writeLine=(a,b)=>{this.push(` * ${a}\n`),b()},this.writeLineBreak=a=>{this.push(" *\n"),a()},this.writeTypes=a=>{_async.default.eachOfSeries(this.Types,(a,b,c)=>{_async.default.series([this.openComment,a=>this.writeLine(`@typedef ${b}Field`,a),a=>this.writeLine(`@desc A Keystone.js \
{@link https://keystonejs.com/api/field/${_lodash.default.toLower(b)}|${b}} Field.`,a),this.closeComment],c)},a)},this.Types=a,this.isReading=!1}_read(){this.isReading||(this.isReading=!0,this.startReading())}startReading(){_async.default.series([this.writeTypes],a=>{a?this.emit("error",a):this.push(null)})}}const createTypeDefs=(a,b)=>{const c=_path.default.resolve(_config.default.outdir,"Types.js"),d=new TypeReader(_lodash.default.omit(a.Field.Types,["AzureFile"])),e=(0,_mississippi.concat)(a=>_fsExtra.default.ensureFile(c).then(()=>_fsExtra.default.outputFile(c,a)));(0,_mississippi.pipe)(d,e,a=>{d.destroy(),b(a)})};exports.createTypeDefs=createTypeDefs;